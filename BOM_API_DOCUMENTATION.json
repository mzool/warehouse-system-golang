{
  "api_version": "v1",
  "base_url": "http://localhost:8080/api/v1",
  "authentication": {
    "type": "session-based",
    "cookie_name": "session",
    "note": "All endpoints require authentication. Include session cookie in requests."
  },
  "endpoints": {
    "create_bom": {
      "method": "POST",
      "path": "/bom",
      "description": "Create a new Bill of Materials entry. Supports both basic and comprehensive fields.",
      "request": {
        "headers": {
          "Content-Type": "application/json"
        },
        "body": {
          "required_fields": {
            "finished_material_id": {
              "type": "integer",
              "description": "ID of the finished/final product"
            },
            "component_material_id": {
              "type": "integer",
              "description": "ID of the component/raw material"
            },
            "quantity": {
              "type": "number",
              "description": "Quantity of component needed (must be > 0)",
              "example": 2.5
            },
            "unit_measure_id": {
              "type": "integer",
              "description": "Unit of measure ID"
            }
          },
          "optional_fields": {
            "scrap_percentage": {
              "type": "number",
              "description": "Expected waste percentage (0-100)",
              "example": 5.0,
              "default": 0.0
            },
            "version": {
              "type": "string",
              "description": "BOM version for change tracking",
              "example": "1.0",
              "default": "1.0"
            },
            "priority": {
              "type": "integer",
              "description": "Assembly priority/sequence (lower = higher priority)",
              "example": 1,
              "default": 1
            },
            "fixed_quantity": {
              "type": "boolean",
              "description": "If true, quantity doesn't scale with production (e.g., setup materials)",
              "example": false,
              "default": false
            },
            "is_optional": {
              "type": "boolean",
              "description": "Whether component is optional in assembly",
              "example": false,
              "default": false
            },
            "reference_designator": {
              "type": "string",
              "description": "Engineering reference (e.g., R1, C2, U5)",
              "example": "R1"
            },
            "notes": {
              "type": "string",
              "description": "Assembly instructions or special notes",
              "example": "Install with thermal paste"
            },
            "effective_date": {
              "type": "string",
              "format": "YYYY-MM-DD",
              "description": "When BOM version becomes effective",
              "example": "2026-01-01"
            },
            "expiry_date": {
              "type": "string",
              "format": "YYYY-MM-DD",
              "description": "When BOM version expires/is superseded",
              "example": "2027-01-01"
            },
            "operation_sequence": {
              "type": "integer",
              "description": "Manufacturing step number where component is used",
              "example": 1
            },
            "estimated_cost": {
              "type": "number",
              "description": "Estimated component cost",
              "example": 25.50
            },
            "actual_cost": {
              "type": "number",
              "description": "Historical/actual average cost",
              "example": 27.35
            },
            "lead_time_days": {
              "type": "integer",
              "description": "Procurement lead time in days",
              "example": 7,
              "default": 0
            },
            "supplier_id": {
              "type": "integer",
              "description": "Preferred supplier for component"
            },
            "alternate_component_id": {
              "type": "integer",
              "description": "Alternative/substitute component ID"
            },
            "is_active": {
              "type": "boolean",
              "description": "Whether BOM entry is currently active",
              "example": true,
              "default": true
            }
          }
        },
        "example": {
          "finished_material_id": 10,
          "component_material_id": 5,
          "quantity": 2.5,
          "unit_measure_id": 3,
          "scrap_percentage": 5.0,
          "version": "2.0",
          "priority": 1,
          "notes": "Install with care",
          "effective_date": "2026-02-01"
        }
      },
      "response": {
        "success": {
          "status": 201,
          "body": {
            "id": 1,
            "finished_material_id": 10,
            "component_material_id": 5,
            "quantity": "2.5000",
            "unit_measure_id": 3,
            "scrap_percentage": "5.00",
            "version": "2.0",
            "priority": 1,
            "finished_material_name": "Wooden Chair",
            "finished_material_code": "WC-001",
            "component_material_name": "Wood Plank",
            "component_material_code": "WP-100",
            "unit_name": "Pieces",
            "unit_abbreviation": "pcs",
            "created_at": "2026-01-27T10:00:00Z",
            "updated_at": "2026-01-27T10:00:00Z"
          }
        },
        "errors": {
          "400": {
            "error": "Invalid request payload | Invalid quantity | Scrap percentage must be 0-100"
          },
          "401": {
            "error": "Unauthorized - Authentication required"
          },
          "409": {
            "error": "BOM already exists for this combination"
          },
          "500": {
            "error": "Internal server error"
          }
        }
      }
    },
    "get_bom": {
      "method": "GET",
      "path": "/bom/{id}",
      "description": "Get a specific BOM entry by ID",
      "request": {
        "path_parameters": {
          "id": {
            "type": "integer",
            "description": "BOM entry ID",
            "required": true
          }
        },
        "example": "/bom/1"
      },
      "response": {
        "success": {
          "status": 200,
          "body": {
            "id": 1,
            "finished_material_id": 10,
            "component_material_id": 5,
            "quantity": "2.5000",
            "unit_measure_id": 3,
            "finished_material_name": "Wooden Chair",
            "component_material_name": "Wood Plank",
            "created_at": "2026-01-27T10:00:00Z"
          }
        }
      }
    },
    "update_bom": {
      "method": "PUT",
      "path": "/bom/{id}",
      "description": "Update an existing BOM entry. All fields are optional - only provided fields will be updated.",
      "request": {
        "path_parameters": {
          "id": {
            "type": "integer",
            "description": "BOM entry ID",
            "required": true
          }
        },
        "body": {
          "all_fields_optional": true,
          "fields": {
            "quantity": "number",
            "scrap_percentage": "number (0-100)",
            "version": "string",
            "priority": "integer",
            "is_active": "boolean",
            "actual_cost": "number",
            "notes": "string"
          }
        },
        "example": {
          "quantity": 3.0,
          "scrap_percentage": 8.0,
          "actual_cost": 27.35
        }
      },
      "response": {
        "success": {
          "status": 200,
          "body": {
            "id": 1,
            "quantity": "3.0000",
            "scrap_percentage": "8.00",
            "actual_cost": "27.35",
            "updated_at": "2026-01-27T10:30:00Z"
          }
        }
      }
    },
    "delete_bom": {
      "method": "DELETE",
      "path": "/bom/{id}",
      "description": "Delete a BOM entry (hard delete)",
      "request": {
        "path_parameters": {
          "id": {
            "type": "integer",
            "description": "BOM entry ID",
            "required": true
          }
        }
      },
      "response": {
        "success": {
          "status": 200,
          "body": {
            "message": "BOM deleted successfully"
          }
        }
      }
    },
    "list_boms": {
      "method": "GET",
      "path": "/bom",
      "description": "List all BOMs with pagination and search. Excludes archived BOMs.",
      "request": {
        "query_parameters": {
          "page": {
            "type": "integer",
            "description": "Page number",
            "default": 1,
            "example": 1
          },
          "limit": {
            "type": "integer",
            "description": "Items per page",
            "default": 20,
            "example": 20
          },
          "q": {
            "type": "string",
            "description": "Search query (searches material names/codes)",
            "example": "chair"
          }
        },
        "example": "/bom?page=1&limit=20&q=chair"
      },
      "response": {
        "success": {
          "status": 200,
          "body": {
            "boms": [
              {
                "id": 1,
                "finished_material_id": 10,
                "component_material_id": 5,
                "quantity": "2.5000",
                "finished_material_name": "Wooden Chair",
                "component_material_name": "Wood Plank"
              }
            ],
            "pagination": {
              "page": 1,
              "limit": 20,
              "total": 45,
              "total_pages": 3
            }
          }
        }
      }
    },
    "get_components_for_product": {
      "method": "GET",
      "path": "/bom/finished-material/{id}",
      "description": "Get all components/raw materials needed to produce a specific finished product. Ordered by priority.",
      "request": {
        "path_parameters": {
          "id": {
            "type": "integer",
            "description": "Finished material ID",
            "required": true
          }
        },
        "example": "/bom/finished-material/10"
      },
      "response": {
        "success": {
          "status": 200,
          "body": {
            "finished_material_id": 10,
            "components": [
              {
                "id": 1,
                "component_material_id": 5,
                "component_material_name": "Wood Plank",
                "component_material_code": "WP-100",
                "quantity": "2.5000",
                "scrap_percentage": "5.00",
                "adjusted_quantity": "2.6250",
                "priority": 1,
                "unit_name": "Pieces",
                "unit_abbreviation": "pcs"
              },
              {
                "id": 2,
                "component_material_id": 7,
                "component_material_name": "Screws",
                "quantity": "4.0000",
                "priority": 2
              }
            ]
          }
        }
      }
    },
    "get_total_cost": {
      "method": "GET",
      "path": "/bom/finished-material/{id}/cost",
      "description": "Calculate total cost of all components needed for a finished material. Includes scrap percentage adjustments.",
      "request": {
        "path_parameters": {
          "id": {
            "type": "integer",
            "description": "Finished material ID",
            "required": true
          }
        },
        "example": "/bom/finished-material/10/cost"
      },
      "response": {
        "success": {
          "status": 200,
          "body": {
            "finished_material_id": 10,
            "total_cost": 125.50
          }
        }
      }
    },
    "get_active_boms": {
      "method": "GET",
      "path": "/bom/active/{id}",
      "description": "Get only active, currently effective BOMs for a finished material. Filters by is_active=true, archived=false, and effective dates. Best for production planning.",
      "request": {
        "path_parameters": {
          "id": {
            "type": "integer",
            "description": "Finished material ID",
            "required": true
          }
        },
        "example": "/bom/active/10"
      },
      "response": {
        "success": {
          "status": 200,
          "body": {
            "finished_material_id": 10,
            "components": [
              {
                "id": 1,
                "component_material_id": 5,
                "component_material_name": "Wood Plank",
                "quantity": "2.5000",
                "scrap_percentage": "5.00",
                "adjusted_quantity": "2.6250",
                "calculated_cost": "26.25",
                "priority": 1,
                "is_optional": false,
                "supplier_name": "ABC Supplier"
              }
            ]
          }
        }
      },
      "use_case": "Production planning - get what's needed right now for manufacturing"
    },
    "get_cost_breakdown": {
      "method": "GET",
      "path": "/bom/cost-breakdown/{id}",
      "description": "Get detailed component-level cost breakdown with scrap adjustments. Shows individual component costs and total.",
      "request": {
        "path_parameters": {
          "id": {
            "type": "integer",
            "description": "Finished material ID",
            "required": true
          }
        },
        "example": "/bom/cost-breakdown/10"
      },
      "response": {
        "success": {
          "status": 200,
          "body": {
            "finished_material_id": 10,
            "breakdown": [
              {
                "component_id": 5,
                "component_name": "Wood Plank",
                "component_code": "WP-100",
                "quantity": "2.5000",
                "scrap_percentage": "5.00",
                "adjusted_quantity": "2.6250",
                "unit_price": "10.00",
                "total_cost": "26.25",
                "unit": "pcs",
                "is_optional": false,
                "fixed_quantity": false
              }
            ],
            "total_cost": 125.50
          }
        }
      },
      "use_case": "Cost analysis, pricing decisions, profitability tracking"
    },
    "get_versions": {
      "method": "GET",
      "path": "/bom/versions/{id}",
      "description": "List all versions of a BOM for change tracking and audit trail.",
      "request": {
        "path_parameters": {
          "id": {
            "type": "integer",
            "description": "Finished material ID",
            "required": true
          }
        },
        "example": "/bom/versions/10"
      },
      "response": {
        "success": {
          "status": 200,
          "body": {
            "finished_material_id": 10,
            "versions": [
              {
                "version": "2.0",
                "component_count": 5,
                "effective_date": "2026-01-01",
                "expiry_date": null,
                "all_active": true
              },
              {
                "version": "1.0",
                "component_count": 4,
                "effective_date": "2025-01-01",
                "expiry_date": "2025-12-31",
                "all_active": false
              }
            ]
          }
        }
      },
      "use_case": "Engineering change management, version history tracking"
    },
    "archive_bom": {
      "method": "POST",
      "path": "/bom/archive/{id}",
      "description": "Archive a BOM entry (soft delete). Sets archived=true, archived_at=now, archived_by=current_user. Archived BOMs are excluded from list queries but can still be accessed by ID.",
      "request": {
        "path_parameters": {
          "id": {
            "type": "integer",
            "description": "BOM entry ID",
            "required": true
          }
        },
        "example": "/bom/archive/123"
      },
      "response": {
        "success": {
          "status": 200,
          "body": {
            "id": 123,
            "archived": true,
            "archived_at": "2026-01-27T15:30:00Z",
            "archived_by": 5
          }
        }
      },
      "use_case": "Retire old BOMs without losing historical data"
    },
    "get_optional_components": {
      "method": "GET",
      "path": "/bom/optional/{id}",
      "description": "Get all optional components for a finished material. Useful for configure-to-order products.",
      "request": {
        "path_parameters": {
          "id": {
            "type": "integer",
            "description": "Finished material ID",
            "required": true
          }
        },
        "example": "/bom/optional/10"
      },
      "response": {
        "success": {
          "status": 200,
          "body": {
            "finished_material_id": 10,
            "optional_components": [
              {
                "id": 15,
                "component_id": 20,
                "component_name": "Premium Finish",
                "component_code": "PF-001",
                "quantity": "1.0000",
                "priority": 5,
                "unit": "liter"
              }
            ]
          }
        }
      },
      "use_case": "Configure-to-order products, customer customization options"
    }
  },
  "common_workflows": {
    "create_basic_bom": {
      "description": "Create a simple BOM with minimum required fields",
      "steps": [
        {
          "step": 1,
          "action": "POST /bom",
          "body": {
            "finished_material_id": 10,
            "component_material_id": 5,
            "quantity": 2.5,
            "unit_measure_id": 3
          }
        }
      ]
    },
    "create_comprehensive_bom": {
      "description": "Create a comprehensive BOM with advanced manufacturing features",
      "steps": [
        {
          "step": 1,
          "action": "POST /bom",
          "body": {
            "finished_material_id": 10,
            "component_material_id": 5,
            "quantity": 2.5,
            "unit_measure_id": 3,
            "scrap_percentage": 5.0,
            "version": "2.0",
            "priority": 1,
            "fixed_quantity": false,
            "is_optional": false,
            "notes": "Install with care",
            "supplier_id": 10,
            "lead_time_days": 7,
            "estimated_cost": 25.50,
            "effective_date": "2026-02-01"
          }
        }
      ]
    },
    "production_planning": {
      "description": "Calculate materials needed for production",
      "steps": [
        {
          "step": 1,
          "action": "GET /bom/active/10",
          "description": "Get active BOMs only"
        },
        {
          "step": 2,
          "calculation": "For each component: required = fixed_quantity ? adjusted_quantity : adjusted_quantity * production_qty",
          "description": "Calculate total materials needed"
        }
      ]
    },
    "cost_analysis": {
      "description": "Analyze product cost breakdown",
      "steps": [
        {
          "step": 1,
          "action": "GET /bom/cost-breakdown/10",
          "description": "Get detailed cost breakdown"
        },
        {
          "step": 2,
          "calculation": "totalCost = materialCost + overhead + labor",
          "description": "Add overhead and labor"
        },
        {
          "step": 3,
          "calculation": "price = totalCost * (1 + margin)",
          "description": "Calculate selling price"
        }
      ]
    },
    "version_management": {
      "description": "Create new BOM version",
      "steps": [
        {
          "step": 1,
          "action": "POST /bom",
          "body": {
            "finished_material_id": 10,
            "component_material_id": 15,
            "quantity": 3.0,
            "version": "2.1",
            "effective_date": "2026-02-01",
            "notes": "Updated design"
          }
        },
        {
          "step": 2,
          "action": "POST /bom/archive/{old_version_id}",
          "description": "Archive old version"
        }
      ]
    }
  },
  "field_descriptions": {
    "scrap_percentage": {
      "description": "Expected waste percentage (0-100)",
      "formula": "adjusted_quantity = quantity * (1 + scrap_percentage/100)",
      "example": "quantity=100, scrap=5% â†’ adjusted_quantity=105"
    },
    "fixed_quantity": {
      "description": "If true, quantity doesn't scale with production quantity",
      "use_case": "Setup materials, tooling, fixtures that are needed once regardless of batch size"
    },
    "is_optional": {
      "description": "Component is optional (customer choice)",
      "use_case": "Premium finishes, add-ons, customization options"
    },
    "priority": {
      "description": "Assembly priority/sequence (1 = first, higher = later)",
      "use_case": "Assembly line sequencing, dependency management"
    },
    "version": {
      "description": "BOM version string for change tracking",
      "pattern": "Typically '1.0', '2.0', 'Rev-A', etc."
    },
    "effective_date": {
      "description": "Date when this BOM version becomes active",
      "format": "YYYY-MM-DD"
    },
    "expiry_date": {
      "description": "Date when this BOM version expires",
      "format": "YYYY-MM-DD"
    }
  },
  "error_handling": {
    "400": {
      "description": "Bad request - Invalid input",
      "common_causes": [
        "Missing required fields",
        "Invalid data types",
        "Scrap percentage not in 0-100 range",
        "Quantity <= 0",
        "Invalid date format"
      ]
    },
    "401": {
      "description": "Unauthorized - Authentication required",
      "solution": "Ensure session cookie is included in request"
    },
    "404": {
      "description": "Not found",
      "common_causes": [
        "BOM ID doesn't exist",
        "Material ID doesn't exist"
      ]
    },
    "409": {
      "description": "Conflict - Duplicate entry",
      "cause": "BOM already exists for this finished_material + component + version combination"
    },
    "500": {
      "description": "Internal server error",
      "solution": "Contact backend team"
    }
  },
  "tips": {
    "pagination": "Use page and limit parameters for large datasets. Default limit is 20.",
    "search": "Use 'q' parameter to search material names and codes.",
    "cost_calculation": "Use /bom/cost-breakdown for detailed analysis, /bom/finished-material/{id}/cost for quick total.",
    "active_vs_all": "Use /bom/active/{id} for production planning (excludes inactive/expired), /bom/finished-material/{id} for all BOMs.",
    "versioning": "Create new versions with different 'version' field values. Archive old versions when superseded.",
    "scrap_adjustment": "adjusted_quantity automatically includes scrap percentage for material planning."
  }
}
